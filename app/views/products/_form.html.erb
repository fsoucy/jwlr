<div class="pure-g log-in">
  <div class="pure-u-1 pure-u-md-1-3"></div>
  <div class="pure-u-1 pure-u-md-1-3 log-in-form">
    <%= form_for(@product,  html: { multipart: true, class: "pure-form pure-form-stacked"} ) do |f| %>
    <fieldset id="product_form">
      <legend>Upload Product</legend>
      <%= render 'shared/error_messages', object: f.object %>
    
      <%= f.text_field :title, placeholder: 'Title' %>

      $ <%= f.number_field :price, placeholder: 'Price' %>

      <%= f.label :category_id, "Product Type" %>
      <%= f.select :category_id, nested_dropdown(Category.where(:parent_id => nil), true) %>
      

      <% if @has %>
        <%= f.label :store_id, "Store of Product" %>
        <%= f.select :store_id, options_for_select(@stos, @default) %>
      <% else %>
        <%= f.text_field :full_street_address, placeholder: 'Full street address of product' %>
      <% end %>         
    
      <%= f.text_area :description, placeholder: 'Description of product' %>

      <%= f.label :delivery_cost, "Planning on adding a delivery cost? Specify that here. If not, just leave this unchanged." %>
      
      <% if @product.delivery_cost.nil? %>
        $ <%= f.number_field :delivery_cost, value: current_user.default_delivery_cost %>
      <% else %>
        $ <%= f.number_field :delivery_cost %>
      <% end %>
      <p>
        <%= f.submit "Upload product", class: "pure-button pure-button-primary" %>
      </p>
    </fieldset>
    <fieldset id="toggle_options_form">
      <legend>Edit Toggle Options</legend>
      <%= f.label :category_id, "Product Type" %>
      <%= f.select :category_id, nested_dropdown(Category.where(:parent_id => nil), true) %>
      <% Category.first.category_options.each do |option| %>
      <%= fields_for "toggle_options[#{option.id}]", option do |opt| %>
      <%= opt.label :name, option.name %>
      <% selected = ToggleOption.joins('INNER JOIN `attribute_options` ON `attribute_options`.`id` = `toggle_options`.`attribute_option_id`').where("product_id = ? AND attribute_options.category_option_id = ?", @product.id, option.id).first %>
      <% if !selected.nil? %>
      <%= opt.select :name, option.attribute_options.all.pluck(:value, :id), :selected => selected.attribute_option_id, class: "pure-checkbox" %>
      <% else %>
      <%= opt.select :name, option.attribute_options.all.pluck(:value, :id), class: "pure-checkbox" %>
      <% end %>
      <% end %>
      <% end %>
      <br>
      <%= f.submit "Submit Toggle Options", class: "pure-button pure-button-primary" %>
    </fieldset>
    <fieldset id="selling_methods_form">
      <legend>Selling Methods</legend>
      <% @selling_methods.each do |selling_method| %>
      <%= fields_for "selling_method_links[#{selling_method.id}]", selling_method do |link| %>
      <% boo = !SellingMethodLink.where("product_id=? AND selling_method_id=?", @product.id, selling_method.id).first.nil? %>
      <label class="pure-checkbox" for="selling_method">
	<%= link.check_box :id, checked: boo, class: "pure-checkbox selling_method"  %> <%= selling_method.method %>
      </label>
      <% end %>
      <% end %>
      <%= f.submit "Save changes", class: "pure-button pure-button-primary" %>
    </fieldset>
    <fieldset id="exchange_methods_form">
      <legend>Exchange Methods</legend>
      <% @exchange_methods.each do |exchange_method| %>
      <%= fields_for "exchange_method_links[#{exchange_method.id}]", exchange_method do |link| %>
      <% boo = !ExchangeMethodLink.where("product_id=? AND exchange_method_id=?", @product.id, exchange_method.id).first.nil? %>
      <label class="pure-checkbox" for="exchange_method">
	<%= link.check_box :id, checked: boo, class: "pure-checkbox" %> <%= exchange_method.method %>
      </label>
      <% end %>
      <% end %>
      <%= f.submit "Save changes", class: "pure-button pure-button-primary" %>
    </fieldset>
    <fieldset id="payment_methods_form">
      <legend>Payment Methods</legend>
      <% @payment_methods.each do |payment_method| %>
      <%= fields_for "payment_method_links[#{payment_method.id}]", payment_method do |link| %>
      <% boo = !PaymentMethodLink.where("product_id=? AND payment_method_id=?", @product.id, payment_method.id).first.nil? %>
      <label class="pure-checkbox" for="payment_method">
	<%= link.check_box :id, checked: boo, class: "pure-checkbox" %> <%= payment_method.method %>
      </label>
      <% end %>
      <% end %>
      <%= f.submit "Save changes", class: "submit_the_form pure-button pure-button-primary" %>
    </fieldset>
    <% end %>
    <div class="pure-u-1 pure-u-md-1-3"></div>
  </div>
</div>
