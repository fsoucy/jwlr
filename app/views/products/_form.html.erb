<%= form_for(@product,  html: { multipart: true}) do |f| %>
<%= render 'shared/error_messages', object: f.object %>

<%= f.label :category_id, "Product Type" %>
<%= f.select :category_id, nested_dropdown(Category.where(:parent_id => nil), true) %>
<br>

<%= f.label :title %>
<%= f.text_field :title, class: 'form-control' %>
<br>

<%= f.label :price, "Price" %>
<%= f.number_field :price, class: 'form-control' %>
<br>

<% if @has %>
<%= f.label :store_id, "Store of Product" %>
<%= f.select :store_id, options_for_select(@stos, @default) %>
<% else %>
<%= f.label :full_street_address, "Address of Product" %>
<%= f.text_field :full_street_address, class: 'form-control' %>
<% end %>      
<br>

<%= f.label :description, "Description of Product + Keywords" %>
<br>
<%= f.text_area :description, class: 'form-control' %>
<br>

<%= f.label :delivery_cost, "Planning on adding a delivery cost? Specify that here. If not, just leave this unchanged." %>
<%= f.number_field :delivery_cost, value: current_user.default_delivery_cost, class: 'form-control' %>

<% if !@product.category.nil? %>
<% @product.category.category_options.each do |option| %>
<%= fields_for "toggle_options[#{option.id}]", option do |opt| %>
<%= opt.label :name, option.name %>
<% selected = ToggleOption.joins('INNER JOIN "attribute_options" ON "attribute_options"."id" = "toggle_options"."attribute_option_id"').where("product_id = ? AND attribute_options.category_option_id = ?", @product.id, option.id).first %>
<% if !selected.nil? %>
<%= opt.select :name, option.attribute_options.all.pluck(:value, :id), :selected => selected.attribute_option_id %><br>
<% else %>
<%= opt.select :name, option.attribute_options.all.pluck(:value, :id) %><br>
<% end %>
<% end %>
<% end %>
<% end %>

<%= f.submit "Upload product", class: "btn btn-primary" %>
<% end %>

