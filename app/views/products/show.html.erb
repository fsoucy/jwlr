<% title = "Product by " + @product.user.name %>
<div class="pure-g search-page">
<div class="pure-u-1 pure-u-md-1-3">
  <h1><%= @product.title %> (<%= @product.category.name %>)</h1>
  
  <% if !@product.pictures.first.nil? %>
  <a id="magnifier" href="<%= @product.pictures.first.photo_cropped(:large) %>">
    <%= image_tag @product.pictures.first.photo_cropped(:medium), class: "product_image" %>
  </a>
  <% if @product.user == current_user %>
  <% link_to("Edit", edit_picture_path(@product.pictures.first)) %>
  <% end %>
  <% end %>
      
  <% @product.pictures.each do |picture| %>
  <%= image_tag picture.photo_cropped(:thumbnail), class: "cropped_show" unless picture == @product.pictures.first %>
  <% if @product.user == current_user %>
  <%= link_to "Edit", edit_picture_path(picture) %>
  <% end %>
  <% end %>
  <% @toggle_options.each do |opt| %>
  <h3><%= opt.attribute_option.category_option.name %>: <%= opt.attribute_option.value %></h3>
  <% end %>
</div>
<div class="pure-u-1 pure-u-md-1-3">
  <h1>Product Details</h1>
  <h3>Price: <%= number_to_currency(@product.price) %></h3>
  <h3>Address: <%= @product.full_street_address %></h3>
  <% unless @distance_away.nil? %>
  <h3>Distance from you: <%= @distance_away.round(1) %> miles</h3>
  <% end %>
  <h3>Owner: <%= @product.user.name %></h3>
  <h3>Description: <%= @product.description %></h3>
  <h3>Views: <%= @product.views %></h3>

  <% if !@product.sold && !@product.hold %>
  <% if @product.user == current_user %><%= link_to "Delete this product", @product, method: :delete, class: "btn btn-primary down",
					    data: { confirm: "Are you sure you wish to delete this?" } %>
  <br>
  <%= link_to "Edit product", edit_product_path(@product.id) %>
  <% else %>
  <% if @product.activated && logged_in? %>
  <% active_deal = Deal.where("product_id = ? and buyer_id = ?", @product.id, current_user).first %>
  <% if active_deal.nil? %>
  <%= form_for(@deal) do |f| %>
  <%= f.hidden_field :seller_id, value: @deal.seller_id %>
  <%= f.hidden_field :buyer_id, value: @deal.buyer_id %>
  <%= f.hidden_field :product_id, value: @deal.product_id %>
  <%= f.submit "Buy this product", class: 'pure-button pure-button-primary' %>
  <% end %>
  <% else %>
  <%= link_to "Go to active deal", deal_path(active_deal.id) %>
  <% end %>
  <% elsif @product.activated %>
  <% store_location %>
  <%= form_tag "/login", method: "get" do %>
  <%= submit_tag "Buy this product", class: 'pure-button pure-button-primary' %>
  <% end %>
  <% end %>
  <% end %>
  <% end %>
</div>
<div class="pure-u-1 pure-u-md-1-3">
  <% if @product.selling_method_links.count < 1 && @product.user == current_user %>
  <a href="<%= edit_selling_methods_product_path(@product) %>"><h1 class = "method_alert">Selling Methods</h1></a>
  <% else %>
  <h1>Selling Methods</h1>
  <% @product.selling_method_links.each do |s| %>
  <h3><%= s.selling_method.method %></h3>
  <% end %>
  <% end %>
  
  <% if @product.exchange_method_links.count < 1 && @product.user == current_user %>
  <a href="<%= edit_exchange_methods_product_path(@product) %>"><h1 class = "method_alert">Exchange Methods</h1></a>
  <% else %>
     
  <h1>Exchange Methods</h1>
  <% @product.exchange_method_links.each do |s| %>
  <h3><%= s.exchange_method.method %></h3>
  <% if s.exchange_method.method == "Delivery" %>
  <h4>Delivery cost: <%= number_to_currency(@product.delivery_cost) %></h4>
  <% end %>
  <% end %>
  <% end %>

  <% if @product.payment_method_links.count < 1 && @product.user == current_user %>
  <a href="<%= edit_selling_methods_product_path(@product) %>"><h1 class = "method_alert">Payment Methods</h1></a>
  <% else %>
  
  <h1>Payment Methods</h1>
  <% @product.payment_method_links.each do |s| %>
  <h3><%= s.payment_method.method %></h3>
  <% end %>
  <% end %>
</div>
</div>
<div class="search-page"><h1>Related Products</h1></div>
<div class="pure-g">
<% unless @more_like_this.nil? %>
<% @more_like_this.each do |prod| %>
<div class="pure-u-1 pure-u-md-1-5">
<%= render prod %>
</div>
<% end
end %>
</div>
