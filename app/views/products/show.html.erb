<% title = "Product by " + @product.user.name %>
<% provide(:title, "Product") %>
<div class="product_show_container">
  <h1><%= @product.title %> (<%= @product.category.name %>)</h1>
  <% if !@product.pictures.first.nil? %>
      <%= image_tag @product.pictures.first.photo_cropped(:medium), class: "product_image" %>
      <% if @product.user.id == current_user.id %>
      <% link_to("Edit", edit_picture_path(@product.pictures.first)) %>
      <% end %>
  <% end %>
  <% @product.pictures.each do |picture| %>
  <%= image_tag picture.photo_cropped(:thumbnail), class: "cropped_show" unless picture == @product.pictures.first %>
  <% if @product.user.id == current_user.id %>
  <%= link_to "Edit", edit_picture_path(picture) %>
  <% end %>
  <% end %>
  <% @toggle_options.each do |opt| %>
  <h3><%= opt.attribute_option.category_option.name %>: <%= opt.attribute_option.value %></h3>
  <% end %>
</div>
<div class="product_show_container">
  <h1>Product Details</h1>
  <h3>Price: <%= number_to_currency(@product.price) %></h3>
  <h3>Address: <%= @product.full_street_address %></h3>
  <% unless @distance_away.nil? %>
  <h3>Distance from you: <%= @distance_away.round(1) %> miles</h3>
  <% end %>
  <h3>Owner: <%= @product.user.name %></h3>
  <h3>Description: <%= @product.description %></h3>
  <h3>Views: <%= @product.views %></h3>
</div>
<div class="product_show_container">
  <% if @product.user == current_user %><%= link_to "Delete this product", @product, method: :delete, class: "btn btn-primary down",
					    data: { confirm: "Are you sure you wish to delete this?" } %>
  <br>
  <%= link_to "Edit product", edit_product_path(@product.id) %>
  <% else %>
  <% if logged_in? %>
  <%= form_for(@deal) do |f| %>
  <%= f.hidden_field :seller_id, value: @deal.seller_id %>
  <%= f.hidden_field :buyer_id, value: @deal.buyer_id %>
  <%= f.hidden_field :product_id, value: @deal.product_id %>
  <%= f.submit "Buy this product" %>
  <% end %>
  <% else %>
  <% store_location %>
  <%= form_tag "/login", method: "get" do %>
  <%= submit_tag "Buy this product" %>
  <% end %>
  <% end %>
  <% end %>
</div>
<div class="product_show_container">
  <h2>Want to submit a review for this product?</h2>
  <textarea class="review"></textarea>
  <button class="submit">Submit Review</button>
</div>
<div class="options">
  <h2>Selling Methods</h2>
  <% @product.selling_method_links.each do |s| %>
  <p><%= s.selling_method.method %></p>
  <% end %>
  <h2>Exchange Methods</h2>
  <% @product.exchange_method_links.each do |s| %>
  <p><%= s.exchange_method.method %></p>
  <% if s.exchange_method.method == "Delivery" %>
  <p>Delivery cost: <%= number_to_currency(@product.delivery_cost) %></p>
  <% end %>
  <% end %>
  <h2>Payment Methods</h2>
  <% @product.payment_method_links.each do |s| %>
  <p><%= s.payment_method.method %></p>
  <% end %>
</div>
<div class="more_like_this">
<% unless @more_like_this.nil? %>
<h1>Related Products</h1>
<% @more_like_this.each do |prod| %>
<a href="<%= product_url(prod) %>">
<div class="product_box">
<%= image_tag prod.pictures.first.photo_cropped(:thumb) unless prod.pictures.first.nil? %>
<p><%= prod.title %><br> <%= number_to_currency(prod.price) %></p>
</div>
</a>
<% end
end %>
</div>
