<% provide(:title, "Search Results") %>
<div class="container">
  <div class="toggle_options">
    <div class="option">
      <h2>Sort By</h2>
      <select id="sort" >
        <option value="relevance">Relevance</option>
        <option value="low">Price: Low to High</option>
        <option value="high">Price: High to Low</option>
      </select> 
      <h2>Category</h2>
      <p>
	<% @categories.rows.each do |facet| %>
	<%= Category.find(facet.value).name %> (<%= facet.count %>): <input type="checkbox" name="category_id" value="<%= facet.value %>" class="toggle"><br>
	<% end %>
      </p>
      <h2>Price</h2>
      <p>
	<% @prices.rows.each do |facet| %>
	<%= number_to_currency(facet.value.to_s.split('..')[0]) %> - <%= number_to_currency(facet.value.to_s.split('..')[1]) %> (<%= facet.count %>): <input class="toggle" type="checkbox" id="price" name="price" value="<%= facet.value %>" ><br>
	<% end %>
      </p>
    <% if !@category.nil? %>
      <h2>Toggle Options</h2>
      <p>
	    <% Category.find(@category).category_options.each do |category_option| %>
        <h3><%= category_option.name %></h3>
        <% category_option.attribute_options.each do |attr| %>
	        <%= attr.value %>: <input type="checkbox" name="attribute_option_id" value="<%= attr.id %>" class="toggle"><br>
	      <% end %>
      <% end %>
      </p>
    <% else %>
      <h2>Select a category to sort</h2>
    <% end %>
    </div>
  </div>
  <div class="search_results">
    <% @results.each do |prod| %>
    <div class="result">
      <div class="image_container_search">
        <%= image_tag prod.picture_url(:thumb), class: "product_image_search" %>
      </div>
      <div class="info_container">
        <%= link_to prod.title, prod, class: "title_link" %>          
        <h3><%= number_to_currency(prod.price) %></h3>
        <h4>Location: <%= Geocoder.address([prod.latitude, prod.longitude]) %></h4>
        <% if logged_in? %>
        <h4>Distance from me: <%= prod.distance_to(current_user, :mi).round(1) %> Miles</h4>
        <% else %>
        <h4>Distance from me: <%= prod.distance_to([request.location.latitude, request.location.longitude], :mi).round(1) %> Miles</h4>
        <% end %>
      </div>
    </div>
    <% end %>
  <%= will_paginate @results %>
  </div>
</div>
